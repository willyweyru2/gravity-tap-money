// Add these variables at the top
let highscore = localStorage.getItem('gravityHighscore') || 0;
let gameSpeed = -200;

function create() {
    // ... (Keep your previous player and obstacle creation)

    // DISPLAY HIGH SCORE
    this.add.text(16, 50, 'Best: ' + highscore, { fontSize: '20px', fill: '#ff0' });

    // CREATE PARTICLES (The "Juice")
    const particles = this.add.particles(0, 0, 'ball', {
        speed: { min: -200, max: 200 },
        angle: { min: 0, max: 360 },
        scale: { start: 0.2, end: 0 },
        blendMode: 'ADD',
        lifespan: 600,
        emitting: false // Only fire on death
    });

    this.physics.add.overlap(player, obstacles, () => {
        // Save High Score
        if (score > highscore) {
            highscore = score;
            localStorage.setItem('gravityHighscore', highscore);
        }

        // Explode!
        particles.emitParticleAt(player.x, player.y, 20);
        player.setVisible(false); // Hide player
        this.cameras.main.shake(100, 0.02);

        this.time.delayedCall(500, () => this.scene.restart());
    }, null, this);
}

function addPipe() {
    let pipe = obstacles.create(400, Math.random() * 600, 'pipe');
    pipe.body.allowGravity = false;
    
    // Increase speed as score goes up
    let speedBoost = Math.floor(score / 5) * 10;
    pipe.setVelocityX(gameSpeed - speedBoost); 
    
    score += 1;
    scoreText.setText('Score: ' + score);
}
